<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta
            name="description"
            content="Edit blog article: <%= article ? article.title : 'Article' %>"
        />
        <title><%= locals.title || 'Edit Article' %> - <%= siteName %></title>
        <link rel="stylesheet" href="/public/css/styles.css" />
    </head>
    <body>
        <header class="header">
            <div class="container">
                <div class="header-content">
                    <a href="/home" class="logo"><%= siteName %></a>
                    <nav>
                        <ul class="nav-links">
                            <li><a href="/home">Home</a></li>
                            <li><a href="/admin">Dashboard</a></li>
                            <li><a href="/articles/new">New Article</a></li>
                        </ul>
                    </nav>
                </div>
            </div>
        </header>

        <main class="content">
            <div class="container">
                <!-- Error Messages -->
                <% if (locals.errors && errors.length > 0) { %>
                <div class="alert alert-error">
                    <ul class="error-list">
                        <% errors.forEach(error => { %>
                        <li>‚Ä¢ <%= error.msg %></li>
                        <% }) %>
                    </ul>
                </div>
                <% } %> <% if (article) { %>
                <div class="card">
                    <div class="card-header">
                        <h1>Edit Article</h1>
                        <p class="card-meta">
                            Editing: "<%= article.title %>" <% if
                            (article.createdAt) { %> ‚Ä¢ Created <%= new
                            Date(article.createdAt).toLocaleDateString() %> <% }
                            %>
                        </p>
                    </div>

                    <form action="/articles/<%= article.id %>" method="POST">
                        <input type="hidden" name="_method" value="PUT" />
                        <div class="form-group">
                            <label for="title" class="form-label"
                                >Article Title *</label
                            >
                            <input
                                type="text"
                                id="title"
                                name="title"
                                class="form-input"
                                required
                                placeholder="Enter a compelling title for your article"
                                value="<%= locals.formData && formData.title ? formData.title : article.title %>"
                                maxlength="200"
                            />
                            <small class="card-meta"
                                >Keep it concise and engaging (3-200
                                characters)</small
                            >
                        </div>

                        <div class="form-group">
                            <label for="publishDate" class="form-label"
                                >Publish Date *</label
                            >
                            <input
                                type="date"
                                id="publishDate"
                                name="publishDate"
                                class="form-input"
                                required
                                value="<%= locals.formData && formData.publishDate ? formData.publishDate : article.publishDate %>"
                            />
                            <small class="card-meta"
                                >When should this article be published?</small
                            >
                        </div>

                        <div class="form-group">
                            <label for="content" class="form-label"
                                >Article Content *</label
                            >
                            <textarea
                                id="content"
                                name="content"
                                class="form-textarea"
                                required
                                placeholder="Write your article content here. You can use line breaks for paragraphs."
                                style="min-height: 300px"
                            >
<%= locals.formData && formData.content ? formData.content : article.content %></textarea
                            >
                            <small class="card-meta"
                                >Minimum 10 characters. Use line breaks to
                                separate paragraphs.</small
                            >
                        </div>

                        <div class="card-actions">
                            <button type="submit" class="btn btn-success">
                                üíæ Update Article
                            </button>
                            <a
                                href="/articles/<%= article.id %>"
                                class="btn btn-secondary"
                            >
                                üëÅÔ∏è Preview
                            </a>
                            <a href="/admin" class="btn btn-secondary">
                                Cancel
                            </a>
                        </div>
                    </form>
                </div>

                <!-- Article Info -->
                <div class="card">
                    <div class="card-header">
                        <h3>üìä Article Information</h3>
                    </div>
                    <div class="card-content">
                        <div
                            style="
                                display: grid;
                                grid-template-columns: repeat(
                                    auto-fit,
                                    minmax(200px, 1fr)
                                );
                                gap: 1rem;
                            "
                        >
                            <div>
                                <strong>Article ID:</strong><br />
                                <code
                                    style="font-size: 0.875rem; color: #7f8c8d"
                                    ><%= article.id %></code
                                >
                            </div>
                            <% if (article.createdAt) { %>
                            <div>
                                <strong>Created:</strong><br />
                                <%= new Date(article.createdAt).toLocaleString()
                                %>
                            </div>
                            <% } %> <% if (article.updatedAt &&
                            article.updatedAt !== article.createdAt) { %>
                            <div>
                                <strong>Last Updated:</strong><br />
                                <%= new Date(article.updatedAt).toLocaleString()
                                %>
                            </div>
                            <% } %>
                            <div>
                                <strong>Public URL:</strong><br />
                                <a
                                    href="/articles/<%= article.id %>"
                                    target="_blank"
                                    >/articles/<%= article.id %></a
                                >
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Danger Zone -->
                <div class="card" style="border-left: 4px solid #e74c3c">
                    <div class="card-header">
                        <h3 style="color: #e74c3c">‚ö†Ô∏è Danger Zone</h3>
                    </div>
                    <div class="card-content">
                        <p>
                            Once you delete an article, there is no going back.
                            Please be certain.
                        </p>
                        <form
                            action="/articles/delete/<%= article.id %>"
                            method="POST"
                            style="display: inline"
                            onsubmit="return confirm('Are you absolutely sure you want to delete this article? This action cannot be undone.')"
                        >
                            <input
                                type="hidden"
                                name="_method"
                                value="DELETE"
                            />
                            <button type="submit" class="btn btn-danger">
                                üóëÔ∏è Delete Article
                            </button>
                        </form>
                    </div>
                </div>
                <% } else { %>
                <div class="card text-center">
                    <div class="card-header">
                        <h1>Article Not Found</h1>
                    </div>
                    <div class="card-content">
                        <p>
                            The article you're trying to edit doesn't exist or
                            has been removed.
                        </p>
                    </div>
                    <div class="card-actions" style="justify-content: center">
                        <a href="/admin" class="btn btn-primary"
                            >Back to Dashboard</a
                        >
                    </div>
                </div>
                <% } %>
            </div>
        </main>

        <footer class="footer">
            <div class="container">
                <p>
                    &copy; <%= currentYear %> <%= siteName %>. Built with
                    Node.js and Express.
                </p>
            </div>
        </footer>

        <!-- Character counter and form enhancements -->
        <script>
            document.addEventListener("DOMContentLoaded", function () {
                const titleInput = document.getElementById("title");
                const contentTextarea = document.getElementById("content");

                if (titleInput && contentTextarea) {
                    // Title character counter
                    function updateTitleCounter() {
                        const remaining = 200 - titleInput.value.length;
                        const counterElement =
                            titleInput.parentNode.querySelector(
                                ".char-counter"
                            ) ||
                            Object.assign(document.createElement("small"), {
                                className: "card-meta char-counter",
                                style: "display: block; margin-top: 0.25rem;",
                            });

                        counterElement.textContent = `${titleInput.value.length}/200 characters`;
                        counterElement.style.color =
                            remaining < 20 ? "#e74c3c" : "#7f8c8d";

                        if (
                            !titleInput.parentNode.querySelector(
                                ".char-counter"
                            )
                        ) {
                            titleInput.parentNode.appendChild(counterElement);
                        }
                    }

                    // Content word counter
                    function updateContentCounter() {
                        const words = contentTextarea.value
                            .trim()
                            .split(/\s+/)
                            .filter((word) => word.length > 0);
                        const wordCount = words.length;
                        const charCount = contentTextarea.value.length;

                        const counterElement =
                            contentTextarea.parentNode.querySelector(
                                ".content-counter"
                            ) ||
                            Object.assign(document.createElement("small"), {
                                className: "card-meta content-counter",
                                style: "display: block; margin-top: 0.25rem;",
                            });

                        counterElement.textContent = `${wordCount} words, ${charCount} characters`;

                        if (
                            !contentTextarea.parentNode.querySelector(
                                ".content-counter"
                            )
                        ) {
                            contentTextarea.parentNode.appendChild(
                                counterElement
                            );
                        }
                    }

                    titleInput.addEventListener("input", updateTitleCounter);
                    contentTextarea.addEventListener(
                        "input",
                        updateContentCounter
                    );

                    // Initialize counters
                    updateTitleCounter();
                    updateContentCounter();
                }
            });
        </script>
    </body>
</html>
