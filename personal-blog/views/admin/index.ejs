<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta
            name="description"
            content="<%= isLoggedIn ? 'Admin dashboard for managing blog articles' : 'Admin login for blog management' %>"
        />
        <title>
            <%= locals.title || (isLoggedIn ? 'Admin Dashboard' : 'Admin Login')
            %> - <%= siteName %>
        </title>
        <link rel="stylesheet" href="/public/css/styles.css" />
    </head>
    <body>
        <header class="header">
            <div class="container">
                <div class="header-content">
                    <a href="/home" class="logo"><%= siteName %></a>
                    <nav>
                        <ul class="nav-links">
                            <li><a href="/home">Home</a></li>
                            <% if (isLoggedIn) { %>
                            <li><a href="/admin">Dashboard</a></li>
                            <li><a href="/articles/new">New Article</a></li>
                            <% } else { %>
                            <li><a href="/admin">Admin</a></li>
                            <% } %>
                        </ul>
                    </nav>
                </div>
            </div>
        </header>

        <main class="content">
            <div class="container">
                <!-- Success/Error Messages -->
                <% if (locals.successMessage) { %>
                <div class="alert alert-success"><%= successMessage %></div>
                <% } %> <% if (locals.errorMessage) { %>
                <div class="alert alert-error"><%= errorMessage %></div>
                <% } %> <% if (locals.errors && errors.length > 0) { %>
                <div class="alert alert-error">
                    <ul class="error-list">
                        <% errors.forEach(error => { %>
                        <li>• <%= error.msg %></li>
                        <% }) %>
                    </ul>
                </div>
                <% } %> <% if (isLoggedIn) { %>
                <!-- Admin Dashboard -->
                <div class="card">
                    <div class="card-header">
                        <h1>Admin Dashboard</h1>
                        <p class="card-meta">
                            Welcome back! <% if (locals.loginTime) { %> Logged
                            in since <%= new Date(loginTime).toLocaleString() %>
                            <% } %>
                        </p>
                    </div>
                    <div class="card-actions">
                        <a href="/articles/new" class="btn btn-primary"
                            >Create New Article</a
                        >
                        <form
                            action="/admin/logout"
                            method="POST"
                            style="display: inline"
                        >
                            <button type="submit" class="btn btn-secondary">
                                Logout
                            </button>
                        </form>
                    </div>
                </div>

                <% if (data && data.length > 0) { %>
                <h2>Published Articles</h2>
                <ul class="article-list">
                    <% data.forEach(article => { %>
                    <li class="article-item">
                        <h3 class="article-title">
                            <a href="/articles/<%= article.id %>"
                                ><%= article.title %></a
                            >
                        </h3>
                        <div class="article-meta">
                            Published on <%= new
                            Date(article.publishDate).toLocaleDateString('en-US',
                            { year: 'numeric', month: 'long', day: 'numeric' })
                            %> <% if (article.updatedAt && article.updatedAt !==
                            article.createdAt) { %> • Updated <%= new
                            Date(article.updatedAt).toLocaleDateString('en-US',
                            { year: 'numeric', month: 'long', day: 'numeric' })
                            %> <% } %>
                        </div>
                        <div class="article-actions">
                            <a
                                href="/articles/<%= article.id %>"
                                class="btn btn-sm btn-secondary"
                                >View</a
                            >
                            <a
                                href="/articles/<%= article.id %>/edit"
                                class="btn btn-sm btn-warning"
                                >Edit</a
                            >
                            <form
                                action="/articles/delete/<%= article.id %>"
                                method="POST"
                                style="display: inline"
                                onsubmit="return confirm('Are you sure you want to delete this article?')"
                            >
                                <input
                                    type="hidden"
                                    name="_method"
                                    value="DELETE"
                                />
                                <button
                                    type="submit"
                                    class="btn btn-sm btn-danger"
                                >
                                    Delete
                                </button>
                            </form>
                        </div>
                    </li>
                    <% }) %>
                </ul>
                <% } else { %>
                <div class="card text-center">
                    <div class="card-content">
                        <h3>No Articles Yet</h3>
                        <p>
                            You haven't created any articles yet. Start by
                            creating your first article!
                        </p>
                        <a href="/articles/new" class="btn btn-primary"
                            >Create First Article</a
                        >
                    </div>
                </div>
                <% } %> <% } else { %>
                <!-- Login Form -->
                <div class="card" style="max-width: 400px; margin: 0 auto">
                    <div class="card-header text-center">
                        <h1>Admin Login</h1>
                        <p class="card-meta">
                            Enter your credentials to access the admin dashboard
                        </p>
                    </div>

                    <form
                        action="/admin/login"
                        method="POST"
                        class="form-group"
                    >
                        <div class="form-group">
                            <label for="passphrase" class="form-label"
                                >Passphrase:</label
                            >
                            <input
                                type="password"
                                id="passphrase"
                                name="passphrase"
                                class="form-input"
                                required
                                placeholder="Enter admin passphrase"
                                autocomplete="current-password"
                            />
                        </div>

                        <button type="submit" class="btn btn-primary w-100">
                            Login to Dashboard
                        </button>
                    </form>

                    <div
                        class="card-content text-center"
                        style="margin-top: 1rem"
                    >
                        <small class="card-meta">
                            For demo purposes, use: <strong>ADMIN</strong>
                        </small>
                    </div>
                </div>
                <% } %>
            </div>
        </main>

        <footer class="footer">
            <div class="container">
                <p>
                    &copy; <%= currentYear %> <%= siteName %>. Built with
                    Node.js and Express.
                </p>
            </div>
        </footer>

        <!-- Method Override Support -->
        <script>
            // Simple confirmation for delete actions
            document.addEventListener("DOMContentLoaded", function () {
                const deleteForms = document.querySelectorAll(
                    'form input[name="_method"][value="DELETE"]'
                );
                deleteForms.forEach((input) => {
                    const form = input.closest("form");
                    if (form) {
                        form.addEventListener("submit", function (e) {
                            if (
                                !confirm(
                                    "Are you sure you want to delete this article? This action cannot be undone."
                                )
                            ) {
                                e.preventDefault();
                            }
                        });
                    }
                });
            });
        </script>
    </body>
</html>
